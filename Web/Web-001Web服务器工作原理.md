### 1. 什么是Web服务器？

Web服务器一般指网站服务器，是指驻留于因特网上某种类型计算机的程序，可以向浏览器等Web客户端提供文档。目前最主流的三个Web服务器是Apache Nginx IIS。

**从严格意义上来讲，Web服务器只负责处理HTTP协议，只能发送静态页面的内容。**

客户端和服务器之间的通信使用HTTP协议进行。**交付的页面最常见的是HTML文档，除了文本内容之外，还可能包含图像，样式表和脚本**。

Web服务器不仅用于为万维网服务。它们也可以被嵌入到诸如打印机，路由器，网络摄像机等设备中，并且仅服务于本地网络。然后，web服务器可以用作用于监视或管理所讨论的设备的系统的一部分。这通常意味着客户端计算机上不需要安装其他软件，因为只需要一个网络浏览器。



### 2. Web服务端工作流程

Web服务器的工作原理并不复杂，一般可分成如下4个步骤：连接过程、请求过程、应答过程以及关闭连接。

**1）客户端发送请求**

　　客户端（通过浏览器）和Web服务器建立TCP连接，连接建立以后，向Web服务器发出访问请求（如get）。根据HTTP协议，该请求中包含了客户端的IP地址、浏览器的类型和请求的URL等一系列信息。

 **2）服务器解析请求**

　　Web服务器对请求按照HTTP协议进行解码来确定进一步的动作，设计的内容有三鼐要点：方法（GET）、文档(/sample.html)、和浏览器使用的协议（HTTP/1.1）其中方法告诉服务器应完动的动作，GET方法的含义很明显是：服务器应定位、读取文件并将它返回给客户。

Web服务器软件现在就知道了，它应该找到文件/sample.html，并使用HTTP/1.1协议将内存返回给客户。信息是经过与请求到来相同的连接发出的，所以服务器不需要定们客户或创建新的连接。

**3）读取其它信息（非必须步骤）**

 　　Web服务器根据需要去读取请求的其它部分。在HTTP/1.1下，客户还应给服务器提供关于它的一些信息。元信息（metainformation）可用来描述浏览器及其能力，以使服务器能据此确定如何返回应答。

**4）完成请求的动作**

　　若现在没有错误出现，WWW服务器将执行请求所要求的动作。如果成功经找到，则发送状态码200，表示一切都OK ，并返回相关文档。如果失败：返回错误指示。若服务器无法找到该资源，则发送状态码404 给客户。

**5）关闭文件和网络连接，结束会话。**

当文件已被发邮或错误已发出后，web服务器结束整个会话。它关闭打开的的被请求文件，关闭网络端口从而结束网络连接。



### 3. 服务器端的组成模块

- TCP监听模块

  服务器监听某个端口（一般默认是8080端口，用户可以设置其他端口），以建立和用户代理之间的连接。一旦建立连接，用户代理的后续HTTP请求将不用再进入监听模块。

- 预处理

  此处主要做三件事：1. 从TCP报文中获取HTTP请求报文。 2. 根据和用户代理的协商进行解密，解压，安全处理等等。3. 根据服务器自身的配置进行安全处理，建立会话状态等等。

- URL路由

  解析URL字符串和动作以确定用户代理请求的资源，根据匹配规则（通常根据正则表达式+后缀）路由到静态资源处理模块或动态资源处理模块。

- 静态资源处理模块

  负责找到静态资源，比如HTML/Javascript/CSS文件/图片/图像，确定内容是字符流或者字节流，并确定对应MIME,比如HTML生成MIME为text/html的字符流，mpeg视频文件生成MIME为video/mpeg的字节流。

- 动态资源处理模块

  运行业务逻辑处理，动态决定返回的资源内容和类型，内容和类型的处理原则同上。

- 后处理

  根据和用户协商的协议进行加密，压缩，安全处理等等。

- 资源输出模块

  把处理好的内容和类型封装成HTTP报文，往TCP连接另一头的用户代理发送TCP报文（内容是HTTP报文）。



### 4. Web应用程序服务器

应用程序服务器(简称应用服务器)。

百度百科的定义如下：

> 通俗的讲，Web服务器传送(serves)页面使浏览器可以浏览，然而**应用程序服务器提供的是客户端应用程序可以调用(call)的方法(methods)。**
>
> 确切一点，你可以说:Web服务器专门处理HTTP请求(request)，但是**应用程序服务器是通过很多协议来为应用程序提供(serves)商业逻辑 (business logic)。**

以Java EE为例，Web服务器主要是处理静态页面处理和作为 Servlet容器，解释和执行servlet/JSP，而应用服务器是运行业务逻辑的，主要是EJB、 JNDI和JMX API等J2EE API方面的，还包含事务处理、数据库连接等功能，所以在企业级应用中，应用服务器提供的功能比WEB服务器强大的多。